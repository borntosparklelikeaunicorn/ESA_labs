# Practical Work #4
*Выполнили студенты группы 6132-010402D Макарова Мария и Таджитдинов Камиль* 
## Java Message Service
### Общая задача
Нужно добавить новую функциональность в ранее созданное приложение, а именно: механизм логирования и watchdog для отслеживания определенных изменений.  
Логирование должно обеспечивать простой механизм записи информации об изменениях в системе в специальную таблицу базы данных.  
Watchdog должен отправлять уведомления по электронной почте о конкретных изменениях в системе на указанные адреса электронной почты.

### Задание 1
Была добавлена новая таблица `audit` в базу данных, где представлены изменения информации в других таблицах базы данных.  
`AuditEntity` определяет сущность для хранения записей изменения в других таблицах.

### Задание 2
`MessagingConfig` содержит конфигурацию JMS, включает создание фабрики слушателей и настройку конвертера сообщений.  
Для организации и обработки очередей сообщений используется *Artemis*, брокер сообщений, который реализует JMS.  
Также были обновлены `application.yml` и `pom.xml`.

### Задание 3
`AuditProducerService` отвечает за отправку сообщений в очередь JMS, когда происходят изменения в сущностях. Он создает сообщения типа `CreateMessage` или `DeleteMessage` в зависимости от события.  
`AuditMessage`, `CreateMessage`, `DeleteMessage` представляют структуру сообщений, которые отправляются в очередь при изменении сущностей.  
Также были изменены и старые файлы проекта.

### Задание 4
`AuditMessageConsumerService` принимает сообщения из очереди и сохраняет информацию о событии в таблице `audit`.
`AuditRepository` – репозиторий для работы с сущностью `AuditEntity`, который сохраняет записи в таблицу `audit`.  
Используется MDP (Message-Driven POJO).

### Задание 5
Реализовано логирование событий типа CREATE и DELETE.  
Была добавлена новая таблица `mailing_rules` в базу данных, где представлены адрес электронной почты для уведомлений, информация об условиях.  

`MailingRulesRepository` предоставляет метод для получения списка email-адресов, связанных с конкретной таблицей.  
`MailingRuleEntity` хранит адреса электронной почты для уведомлений и условия для отслеживания изменений.  
`AuditMailConsumerService` слушает очередь и, если сообщение связано с определенной таблицей, отправляет уведомление на соответствующие email-адреса.  

### Задание 6
`AuditMailConsumerService` – сервис для обработки сообщений и отправки email-уведомлений на основе полученного сообщения.  
`MailingService` – сервис для отправки email-сообщений через SMTP.  

### Задание 7
Пример работы программы можно увидеть на скриншотах:
![image](https://github.com/user-attachments/assets/45618a12-8237-4a51-9a1d-e6d0f58e8d09)
![image](https://github.com/user-attachments/assets/b2cfcda0-252b-4aa6-8256-f8c141137bcd)


